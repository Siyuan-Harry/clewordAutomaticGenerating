import openai
import streamlit as st

openai.api_key = st.secrets["OPENAI_API_KEY"]

example_input = '''
è€å¸ˆï¼šè¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥ä¸€èµ·è®¤è¯†ä¸€ä¸‹Pythonæœ€åŸºç¡€çš„3ç§æ•°æ®ç±»å‹ã€‚

æ²¡æœ‰å¾ˆå¤šï¼Œå°±3ç§ï¼Œè€Œä¸”ä½ åŸºæœ¬éƒ½å’Œä»–ä»¬æ‰“è¿‡ç…§é¢äº†ï¼š

- æ•´æ•°(int)
- æµ®ç‚¹æ•°(float)
- å­—ç¬¦ä¸²(str)

<img src="https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20230916111933.png"/>

### æ•´æ•°int

<img src="https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20230916221934.png"/>

æ•´æ•°(integer) å…¶å®éå¸¸ç®€å•ï¼Œå°±ç­‰åŒäºæˆ‘ä»¬å°å­¦æ•°å­¦é‡Œå­¦åˆ°çš„â€œæ•´æ•°â€æ¦‚å¿µã€‚

æˆ‘ä»¬ä¸Šæ¬¡è®©ä½ print(42)ï¼Œè¿™ä¸ª 42 å°±æ˜¯æ•´æ•°ç±»å‹çš„ã€‚

ä½ å¯ä»¥å¯¹æ•´æ•°è¿›è¡Œå„ç§æ•°å­¦è¿ç®—ï¼Œå°±åƒæˆ‘ä»¬è¯•è¿‡çš„print(1+2) ä¸€æ ·ã€‚

Pythonä¸­çš„è¿ç®—ç¬¦å·å¦‚ä¸‹
<img src="https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20230915181353.png"/>

æˆ‘ä»¬å¯ä»¥æä¸ªç¨å¾®å¤æ‚ç‚¹çš„å¼å­è®©pythonç®—ä¸€ä¸‹ï¼š

```python
print((4+2)*3-8)
```

ä½ å¯ä»¥å°è¯•è¿è¡Œä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯ç§’å‡ºç»“æœï¼Œç»“æœæ˜¯10

å­¦ç”Ÿï¼šæ²¡é”™ã€‚æœç„¶æ˜¯æ•°å­¦å­¦éœ¸~

è€å¸ˆï¼šå“ˆå“ˆå“ˆï¼Œæ²¡é”™ã€‚æˆ‘ä»¬ç»§ç»­ã€‚
'''

example_output = '''Â·
```cleword
- å‘è¨€:
    è°: æ€è¿œ
    è¯´:
    - è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥ä¸€èµ·è®¤è¯†ä¸€ä¸‹Pythonæœ€åŸºç¡€çš„3ç§æ•°æ®ç±»å‹ã€‚
    - æ²¡æœ‰å¾ˆå¤šï¼Œå°±3ç§ï¼Œè€Œä¸”ä½ åŸºæœ¬éƒ½å’Œä»–ä»¬æ‰“è¿‡ç…§é¢äº†ï¼š

- å›¾ç‰‡:
    åœ°å€: https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20230916111933.png

- å¤§çº²:
    æ ‡é¢˜: æ•´æ•°int
    ç­‰çº§: 2

- å›¾ç‰‡:
    åœ°å€: https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20230916221934.png

- å‘è¨€:
    è°: æ€è¿œ
    è¯´:
    - æ•´æ•°(integer) å…¶å®éå¸¸ç®€å•ï¼Œå°±ç­‰åŒäºæˆ‘ä»¬å°å­¦æ•°å­¦é‡Œå­¦åˆ°çš„â€œæ•´æ•°â€æ¦‚å¿µã€‚
    - æˆ‘ä»¬ä¸Šæ¬¡è®©ä½ print(42)ï¼Œè¿™ä¸ª 42 å°±æ˜¯æ•´æ•°ç±»å‹çš„ã€‚
    - ä½ å¯ä»¥å¯¹æ•´æ•°è¿›è¡Œå„ç§æ•°å­¦è¿ç®—ï¼Œå°±åƒæˆ‘ä»¬è¯•è¿‡çš„print(1+2) ä¸€æ ·ã€‚
    - Pythonä¸­çš„è¿ç®—ç¬¦å·å¦‚ä¸‹
- å›¾ç‰‡:
    åœ°å€: https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20230915181353.png

- å‘è¨€:
    è°: æ€è¿œ
    è¯´:
    - æˆ‘ä»¬å¯ä»¥æä¸ªç¨å¾®å¤æ‚ç‚¹çš„å¼å­è®©pythonç®—ä¸€ä¸‹ï¼š
    - |
        ```python
        print((4+2)*3-8)
        ```
    - ä½ å¯ä»¥å°è¯•è¿è¡Œä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯ç§’å‡ºç»“æœï¼Œç»“æœæ˜¯10

- å‘è¨€:
    è°: å­¦ç”Ÿ
    è¯´:
    - æ²¡é”™ã€‚æœç„¶æ˜¯æ•°å­¦å­¦éœ¸~

- å‘è¨€:
    è°: æ€è¿œ
    è¯´:
    - å“ˆå“ˆå“ˆï¼Œæ²¡é”™ã€‚æˆ‘ä»¬ç»§ç»­ã€‚
```
'''

def get_completion_from_messages(messages, model="gpt-4-1106-preview", temperature=0):
        response = openai.ChatCompletion.create(
            model=model,
            messages=messages,
            temperature=temperature, # this is the degree of randomness of the model's output
        )
    #     print(str(response.choices[0].message))
        return response.choices[0].message["content"]

def generate_cleword(content):

    system_message = "ä½ æ˜¯ä¸€åä¼˜ç§€çš„è¯¾ç¨‹æ–‡ç¨¿å½•å…¥å‘˜ï¼Œæ“…é•¿æŠŠmarkdownæ ¼å¼çš„è¯¾ç¨‹æ–‡ç¨¿ï¼Œè½¬åŒ–ä¸ºä¸€ç§å«åšclewordçš„é¢†åŸŸç‰¹å®šè¯­è¨€ã€‚"
    user_message = f"""
              ä½ æ˜¯ä¸€åä¼˜ç§€çš„è¯¾ç¨‹æ–‡ç¨¿å½•å…¥å‘˜ã€‚æˆ‘å°†ç»™ä½ markdownæ ¼å¼çš„è¯¾ç¨‹æ–‡ç¨¿ï¼Œè¯·ä½ å¸®åŠ©æˆ‘æŠŠè¿™ç§æ–‡ç¨¿è½¬åŒ–ä¸ºä¸€ç§å«åšclewordçš„é¢†åŸŸç‰¹å®šè¯­è¨€ã€‚ä¸‹é¢æ˜¯ä¸€äº›è½¬åŒ–çš„åŸºæœ¬è§„åˆ™ï¼š
              clewordæ˜¯ä¸€ç§åŸºäºyamlçš„ï¼Œç¼©è¿›æ•æ„Ÿçš„é¢†åŸŸç‰¹å®šè¯­è¨€ã€‚å®ƒè¢«ä¸“é—¨ç”¨æ¥åˆ›ä½œè¯¾ç¨‹ã€‚
              ä»¥ä¸‹æ˜¯æŸèŠ‚è¯¾éƒ¨åˆ†å†…å®¹çš„clewordè¯­æ³•ç¤ºä¾‹ï¼Œè¿™é—¨è¯¾çš„å†…å®¹æ¼”ç¤ºäº†ä¸€ä¸ªåå«æ€è¿œçš„è€å¸ˆï¼Œæ•™ç»™åå«å¤§ä¹¾çš„å­¦ç”Ÿå…³äºPythonçš„å˜é‡çš„çŸ¥è¯†çš„åœºæ™¯ã€‚è¯·æ³¨æ„å…¶ä¸­å‡ºç°çš„å¯¹äºä¸åŒå…ƒç´ çš„è¯­æ³•è§„åˆ™å’Œç¼©è¿›ï¼Œä»¥åŠæˆ‘ç»™å‡ºçš„ â€œ#â€ å·åé¢çš„è¯­æ³•æ³¨é‡Šï¼š

              ```cleword
                - å‘è¨€:
                    è°: æ€è¿œ
                    è¯´:
                      - okï¼Œé‚£ç°åœ¨è¯·ä½ åœ¨è‡ªå·±çš„ç”µè„‘ä¸­æ‰“å¼€pythonï¼Œæˆ‘ä»¬å¼€å§‹æ¥ä¸‹æ¥çš„å­¦ä¹ âœŠâœŠ #clewordè¯­æ³•æ³¨é‡Šï¼šåœ¨ä¸€ä¸ªâ€å‘è¨€â€œä¸‹é¢ï¼Œæ¯ä¸€ä¸ªçŸ­æ  â€œ - â€ å°±ä»£è¡¨ä¸€æ¡å¯¹è¯æ¶ˆæ¯
                      - å‰é¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Pythonçš„print()å‡½æ•°å’Œ3ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚è¿™èƒ½å¤Ÿè®©PythonæŠŠä¸€äº›ä¸œè¥¿â€œè¯´â€ç»™æˆ‘ä»¬å¬ã€‚

                - å›¾ç‰‡: #clewordè¯­æ³•æ³¨é‡Šï¼šè¯·æ³¨æ„å›¾ç‰‡çš„è¯­æ³•ã€‚
                    åœ°å€: https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20231026105853.png

                - é—®å·: #clewordè¯­æ³•æ³¨é‡Šï¼šé‡åˆ°é€‰æ‹©é¢˜æ—¶ï¼Œå¯ä»¥ç”¨è¿™ç§è¯­æ³•ã€‚
                    ç±»å‹: å•é€‰    #clewordè¯­æ³•æ³¨é‡Šï¼šç±»å‹å¯ä»¥æ˜¯å•é€‰ä¹Ÿå¯ä»¥æ˜¯å¤šé€‰ã€‚
                    æ ‡é¢˜: è¯·å¯¹ä»¥ä¸‹ä½œå‡ºé€‰æ‹©1
                    é€‰é¡¹:
                      - ç¬¬ä¸€é¡¹A
                      - ç¬¬äºŒé¡¹B
                      - ç¬¬ä¸‰é¡¹C
                    ç­”æ¡ˆ:   #clewordè¯­æ³•æ³¨é‡Šï¼šå¦‚æœéœ€è¦è®¾ç½®æ­£ç¡®ç­”æ¡ˆï¼Œåˆ™ä¸‹é¢æ­£ç¡®çš„ç­”æ¡ˆè¦ä¸ä¸Šé¢çš„é€‰é¡¹ä¿æŒä¸€è‡´
                      - ç¬¬ä¸€é¡¹A
                    è§£æ: |   #clewordè¯­æ³•æ³¨é‡Šï¼šç­”æ¡ˆçš„å…·ä½“è§£æ
                      æ­£ç¡®ç­”æ¡ˆæ˜¯ç¬¬ä¸€é¡¹å“¦

                - å‘è¨€:
                    è°: æ€è¿œ
                    è¯´:
                      - ä½†æ˜¯ç›®å‰ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ç¨‹åºéƒ½åªæ˜¯è¿è¡Œä¸€æ­¥ï¼ŒæŠŠä¸€ä¸ªå€¼æ‰“å°å‡ºæ¥ã€‚
                      - |  #clewordè¯­æ³•æ³¨é‡Šï¼šåœ¨â€œ - | â€çš„ä¸‹é¢ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªå¯¹è¯æ¶ˆæ¯å†…å†™ç¬¦åˆmarkdownè¯­æ³•çš„å†…å®¹
                        è¿™å¯¹äºæ›´å¤æ‚çš„ç¨‹åºè€Œè¨€ï¼Œè‚¯å®šæ˜¯ä¸å¤Ÿç”¨çš„ã€‚ 
                        - æ•°æ®å¦‚ä½•åœ¨ç¨‹åºä¸­è¢«ä¼ é€’ï¼Ÿ
                        - å¦‚ä½•å®ç°å¤šä¸ªæ­¥éª¤çš„ç¨‹åºï¼Ÿ 
                      - è¿™äº›éƒ½æ˜¯é—®é¢˜ã€‚
                - å‘è¨€:
                    è°: å¤§ä¹¾
                    è¯´:
                      - å¤æ‚çš„ç¨‹åºï¼Ÿ
                - å‘è¨€:
                    è°: æ€è¿œ
                    è¯´:
                      - ä¸¾ä¸ªå…·ä½“ç‚¹ä¾‹å­æ¥è¯´ï¼Œ
                      - æ¯”å¦‚æˆ‘ä»¬æƒ³ç”¨Pythonå†™ä¸€ä¸ªè¿›åˆ¶è½¬æ¢çš„å°ç¨‹åºï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨æŠŠä½ è¾“å…¥è¿›å»çš„åè¿›åˆ¶è¿›åˆ¶çš„æ•°å­—ï¼Œè½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ•°å­—ã€‚
                      - è¿™ä¸ªç¨‹åºçš„æ„æ¶ä¼šå¤§æ¦‚é•¿ä¸‹é¢è¿™æ ·ï¼š
                - å›¾ç‰‡:
                    åœ°å€: https://siyuan-harry.oss-cn-beijing.aliyuncs.com/oss://siyuan-harry/20231013113342.png

                - å‘è¨€:
                    è°: æ€è¿œ
                    è¯´:
                      - è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ å˜é‡ æ¥å¸®åŠ©è¿™ä¸ªç¨‹åºåšå¾—æ›´å¥½ã€‚

                - å¤§çº²: #clewordè¯­æ³•æ³¨é‡Šï¼šmarkdownæ–‡ç¨¿ä¸­çš„ä¸€äºŒä¸‰çº§æ ‡é¢˜ï¼Œéƒ½åº”å½“è½¬æ¢ä¸ºclewordé‡Œçš„å¯¹åº”ç­‰çº§å¤§çº²
                    æ ‡é¢˜: 1 ä»€ä¹ˆæ˜¯å˜é‡
                    ç­‰çº§: 1

                - å‘è¨€:
                    è°: æ€è¿œ
                    è¯´:
                      - |
                        è™½ç„¶å˜é‡æ˜¯ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œä½†å…¶å®å®ƒä¸€ç‚¹éƒ½ä¸éš¾ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚
                        > åªè¦ä½ ç”¨å¿ƒå»åšï¼
                      - | #clewordè¯­æ³•æ³¨é‡Šï¼šåœ¨â€œ - | â€çš„ä¸‹é¢ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªæ¶ˆæ¯å†…å†™ç¬¦åˆmarkdownè¯­æ³•çš„å†…å®¹ã€‚æ¯”å¦‚è¿™æ¡æ¶ˆæ¯ä¸­æ–‡å­—+Pythonä»£ç å—
                        å¤šè¯´æ— ç›Šï¼Œå…ˆæ¥å°è¯•è¿è¡Œä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä»£ç ï¼š
                        ```python
                        weather = 'ä»Šå¤©çš„å¤©æ°”æ˜¯å¤šäº‘è½¬æ™´'
                        print(weather)
                        ```
                      - è¿˜æœ‰ä¸‹é¢è¿™ä¸ª:
                      - |
                        ```python
                        number = -4

                        if number > 0:
                            print("è¿™æ˜¯ä¸€ä¸ªæ­£æ•°")

                        print('123')
                        ```

                - æ—ç™½: è¯·è‡ªå·±åœ¨æœ¬åœ°çš„ç¼–è¾‘å™¨é‡Œæ‰‹æ‰“å‡ºæ¥ï¼Œä¸è¦å¤åˆ¶ç²˜è´´å“¦ #clewordè¯­æ³•æ³¨é‡Šï¼šâ€œæ—ç™½â€çš„è¯­æ³•å°±æ˜¯è¿™æ ·çš„
              ```

              æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ç»™ä½ ä¸€ä¸ªmarkdownç‰ˆæœ¬çš„åŸå§‹è¯¾ç¨‹æ–‡ç¨¿ã€‚è¯·ä½ æŠŠå®ƒè½¬åŒ–ä¸ºclewordæ ¼å¼è¾“å‡ºã€‚
              åŸå§‹æ–‡ç¨¿ï¼šã€Œ{content}ã€

              è¯·ä½ æ³¨æ„åŸå§‹æ–‡ç¨¿é‡Œçš„markdownè¯­æ³•æ ¼å¼ï¼ˆå¦‚äººç‰©æ ‡è®°ã€å›¾ç‰‡ã€æ—ç™½æ ‡è®°ã€ä»£ç å—ç­‰ï¼‰ï¼Œå¹¶å°†åŸå§‹æ–‡ç¨¿é€å¥åœ°è½¬åŒ–ä¸ºç¬¦åˆclewordè¯­æ³•çš„æ ¼å¼ã€‚

            """
    messages =  [
                {'role':'system',
                'content': system_message},
                {'role':'user',
                'content': user_message},
            ]
    response = get_completion_from_messages(messages)
    return response

def app():
    
    st.title('''Markdown-to-Cleword v0.0.1 ğŸ‰''')

    col1, col2 = st.columns(2)
    
    with col1:
        script = st.text_area('è¯·è¾“å…¥ä½ æƒ³è¦è½¬ä¸ºclewordçš„markdownæ–‡ç¨¿ï¼š')
        btn = st.button('æäº¤')

        with st.expander('è¾“å…¥ç¤ºä¾‹'):
            st.text_area('', value = example_input, height=500)

        with st.expander('è¾“å‡ºç¤ºä¾‹'):
             st.markdown(example_output)

    with col2:
        st.markdown('è½¬åŒ–ç»“æœå¦‚ä¸‹ğŸ‘‡')
        if btn:
            cleword = generate_cleword(script)
            st.markdown(cleword)
    

if __name__ == '__main__':
    app()